<launch>
  <!-- planning module -->
  <arg name="vehicle_param_file"/>

  <!-- common -->
  <arg name="common_param_path"/>
  <arg name="nearest_search_param_path"/>
  <!-- mission planner -->
  <arg name="mission_planner_param_path" default="$(find-pkg-share autoware_launch)/config/planning/mission_planning/mission_planner/mission_planner.param.yaml"/>
  <!-- behavior path planner -->
  <arg name="scene_module_manager_param_path" value="$(find-pkg-share autoware_launch)/config/planning/scenario_planning/lane_driving/behavior_planning/behavior_path_planner/scene_module_manager.param.yaml"/>
  <arg name="side_shift_param_path"/>
  <arg name="avoidance_param_path"/>
  <arg name="dynamic_avoidance_param_path"/>
  <arg name="lane_change_param_path"/>
  <arg name="goal_planner_param_path"/>
  <arg name="pull_out_param_path"/>
  <arg name="drivable_area_expansion_param_path"/>
  <arg name="behavior_path_planner_param_path"/>
  <!-- behavior velocity planner -->
  <arg name="behavior_velocity_smoother_type_param_path"/>
  <arg name="behavior_velocity_planner_param_path"/>
  <!-- motion -->
  <arg name="obstacle_avoidance_planner_param_path"/>
  <!-- motion velocity smoother -->
  <arg name="motion_velocity_smoother_param_path"/>

  <group>
    <push-ros-namespace namespace="planning"/>

    <group>
      <push-ros-namespace namespace="mission_planning"/>

      <!-- mission planning module -->
      <include file="$(find-pkg-share mission_planner)/launch/mission_planner.launch.xml"/>
    </group>

    <group>
      <push-ros-namespace namespace="scenario_planning"/>

      <group>
        <push-ros-namespace namespace="lane_driving"/>

        <group>
          <push-ros-namespace namespace="behavior_planning"/>

          <!-- behavior_path_planner -->
          <include file="$(find-pkg-share behavior_path_planner)/launch/behavior_path_planner.launch.xml">
            <arg name="vehicle_info_param_file" value="$(var vehicle_info_param_file)"/>
            <arg name="nearest_search_param_path" value="$(var nearest_search_param_path)"/>
            <arg name="common_param_path" value="$(var common_param_path)"/>

            <arg name="scene_module_manager_param_path" value="$(var scene_module_manager_param_path)"/>
            <arg name="side_shift_param_path" value="$(var side_shift_param_path)"/>
            <arg name="avoidance_param_path" value="$(var avoidance_param_path)"/>
            <arg name="avoidance_by_lc_param_path" value="$(var avoidance_by_lc_param_path)"/>
            <arg name="dynamic_avoidance_param_path" value="$(var dynamic_avoidance_param_path)"/>
            <arg name="lane_change_param_path" value="$(var lane_change_param_path)"/>
            <arg name="goal_planner_param_path" value="$(var goal_planner_param_path)"/>
            <arg name="pull_out_param_path" value="$(var pull_out_param_path)"/>
            <arg name="drivable_area_expansion_param_path" value="$(var drivable_area_expansion_param_path)"/>
            <arg name="behavior_path_planner_param_path" value="$(var behavior_path_planner_param_path)"/>
          </include>

          <!-- behavior_velocity_planner -->
          <include file="$(find-pkg-share behavior_velocity_planner)/launch/behavior_velocity_planner.launch.xml">
            <arg name="vehicle_info_param_file" value="$(var vehicle_info_param_file)"/>
            <arg name="nearest_search_param_path" value="$(var nearest_search_param_path)"/>
            <arg name="common_param_path" value="$(var common_param_path)"/>

            <arg name="motion_velocity_smoother_param_path" value="$(var motion_velocity_smoother_param_path)"/>
            <arg name="behavior_velocity_smoother_type_param_path" value="$(var behavior_velocity_smoother_type_param_path)"/>
            <arg name="behavior_velocity_planner_param_path" value="$(var behavior_velocity_planner_param_path)"/>

            <arg name="launch_stop_line" value="False"/>
            <arg name="launch_crosswalk" value="False"/>
            <arg name="launch_traffic_light" value="False"/>
            <arg name="launch_intersection" value="False"/>
            <arg name="launch_blind_spot" value="False"/>
            <arg name="launch_detection_area" value="False"/>
            <arg name="launch_virtual_traffic_light" value="False"/>
            <arg name="launch_occlusion_spot" value="False"/>
            <arg name="launch_no_stopping_area" value="False"/>
            <arg name="launch_speed_bump" value="False"/>
          </include>
        </group>

        <!-- motion planning module -->
        <group>
          <push-ros-namespace namespace="motion_planning"/>
          <set_remap from="~/input/path" to="/planning/scenario_planning/lane_driving/behavior_planning/path"/>
          <set_remap from="~/input/odometry" to="/localization/kinematic_state"/>
          <set_remap from="~/output/path" to="/planning/scenario_planning/lane_driving/trajectory"/>
          <node pkg="obstacle_avoidance_planner" exec="obstacle_avoidance_planner_node" name="obstacle_avoidance_planner" output="screen">
            <param from="$(var vehicle_param_file)"/>
            <param from="$(var nearest_search_param_path)"/>
            <param from="$(var obstacle_avoidance_planner_param_path)"/>
          </node>
        </group>
      </group>

      <!-- scenario selector -->
      <include file="$(find-pkg-share scenario_selector)/launch/scenario_selector.launch.xml"/>
    </group>

    <!-- motion velocity smoother -->
    <group>
      <set_remap from="~/input/trajectory" to="/planning/scenario_planning/scenario_selector/trajectory"/>
      <set_remap from="~/output/trajectory" to="/planning/scenario_planning/trajectory"/>
      <include file="$(find-pkg-share motion_velocity_smoother)/launch/motion_velocity_smoother.launch.xml">
        <arg name="nearest_search_param_path" value="$(var nearest_search_param_path)"/>
        <arg name="common_param_path" value="$(var common_param_path)"/>
      </include>
    </group>
  </group>
</launch>
